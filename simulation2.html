<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gambling Simulation: Capped D'Alembert</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background-color: #f8fafc; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        #stats { margin-bottom: 20px; padding: 15px; background: #e2e8f0; border-radius: 8px; line-height: 1.6; }
        .badge { background: #2563eb; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.9em; }
        canvas { width: 100% !important; height: 500px !important; }
    </style>
</head>
<body>

<div class="container">
    <h2>Betting Simulation: Capped Strategy</h2>
    <div id="stats">Initializing simulation...</div>
    <canvas id="bankrollChart"></canvas>
</div>

<script>
    function runSimulation() {
        // --- Configuration ---
        let bankroll = 1000;
        let currentBet = 1;
        const houseEdge = 0.01; 
        const winProbability = 0.495; // 49.5% win chance
        const totalHands = 1000000;
        const recordInterval = 100;

        const history = [];
        const labels = [];
        let handsPlayed = 0;
        let resetCount = 0; // Track how many times we hit the $20 cap

        for (let i = 1; i <= totalHands; i++) {
            handsPlayed = i;

            // Determine Outcome
            const win = Math.random() < winProbability;

            if (win) {
                bankroll += currentBet;
                currentBet = Math.max(1, currentBet - 1);
            } else {
                bankroll -= currentBet;
                currentBet += 1;
            }

            // --- CAP LOGIC ---
            // If bet reaches $20, drop to $5
            if (currentBet >= 20) {
                currentBet = 5;
                resetCount++;
            }

            // Record data point every 100 hands
            if (i % recordInterval === 0) {
                history.push(parseFloat(bankroll.toFixed(2)));
                labels.push(i);
            }

            // Bankruptcy Check
            if (bankroll <= 0) {
                bankroll = 0;
                history.push(0);
                labels.push(i);
                break;
            }
        }

        updateStats(bankroll, handsPlayed, resetCount);
        renderChart(labels, history);
    }

    function updateStats(finalBankroll, hands, resets) {
        const statsDiv = document.getElementById('stats');
        statsDiv.innerHTML = `
            <strong>Simulation Complete</strong><br>
            Hands Played: <span class="badge">${hands.toLocaleString()}</span> | 
            Final Bankroll: <span class="badge">$${finalBankroll.toLocaleString(undefined, {minimumFractionDigits: 2})}</span> | 
            Bet Resets ($20 â†’ $5): <span class="badge">${resets.toLocaleString()}</span>
            ${finalBankroll <= 0 ? '<br><span style="color:#dc2626; font-weight:bold;">Result: Bankrupt</span>' : ''}
        `;
    }

    function renderChart(labels, data) {
        const ctx = document.getElementById('bankrollChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Bankroll ($)',
                    data: data,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 1.5,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                scales: {
                    x: { title: { display: true, text: 'Hands Played' }, grid: { display: false } },
                    y: { title: { display: true, text: 'Balance ($)' }, beginAtZero: false }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    window.onload = runSimulation;
</script>

</body>
</html>